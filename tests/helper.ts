// tests/helpers/fakeEngine.ts

import { assertContextMatch } from "@/engine/core/assertions";
import { EngineMode } from "@/engine/core/mode";
import { EngineContext, EngineInput, EngineOutput } from "@/engine/core/types";


// TODO check if this could be removed
/**
 * Runs a deterministic version of the engine for testing purposes.
 * Does NOT call AI — returns a fixed output formatted by the mode.
 */
export async function runFakeEngine<TContent>(
  mode: EngineMode<TContent>,
  input: EngineInput<TContent>
): Promise<EngineOutput> {

  assertContextMatch(mode.id, input.context);

  // Build a deterministic raw string based on the mode
  let raw: string;
    console.log("Mode ID:", mode.id);
  switch (mode.id) {
    case EngineContext.MARKETPLACE: 
        const { productName, description, price, platform } = input.content as any;
        raw = `
    Generate a product listing for an online marketplace.

    Item: ${productName}
    Description: ${description}
    Price: ${price ?? "Not specified"}
    Platform: ${platform ?? "Not specified"}

    Tone: ${input.tone}
    Audience: ${input.audience}
    `;
        break;

    case EngineContext.JOB:
        raw = `
    TITLE: Sample title
    DESCRIPTION:
    This is a placeholder response generated by the engine.
    `;
        break;

    default:
        raw = "Deterministic test output";
}

  // Format it using the mode’s formatOutput method
  return mode.formatOutput(raw);
}
